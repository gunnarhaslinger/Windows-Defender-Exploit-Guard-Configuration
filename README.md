# Windows Defender Exploit-Guard Configuration

## This Scripts provide:
* Configure Windows Defender Exploit-Guard by using PowerShell
* Reset all ProcessMitigations to get a clean (unconfigured) state
* Import clean Default-Configuration shipped with the OS
* Import clean recommended Baseline Configuration

## What's the Problem?
Windows 10 v1709 (RS3) includes Windows Defender ExploitGuard (Windows Defender EG), the successor of EMET. There are two powershell commandlets `Get-ProcessMitigation` and `Set-ProcessMitigation` for Configuring the Exploit-Guard Configuration by using scripts, but currently in Windows 10 v1709 (RS3) there are following bugs and a lack of functionality:

* `Get-ProcessMitigation` commandlet does **not** list these executables configured by full-path, only lists those which are defined by plain executable-names without path
* Set-ProcessMitigation commandlet has no functionality to delete a configured process-mitigation or to delete all configured per-process-mitigations like the EMET-Commandline-Tool `EMET_Conf --delete <path to executable>` or `EMET_Conf --delete_apps` or `EMET_Conf --delete_all` provided
* Additionaly in the current (tested 26.01.2018) InsiderBuild of Win10 RS4 (v1803) there is a default process-mitigation for `CameraBarcodeScannerPreview.exe` with Registry-Permissions only for TrustedInstaller (SYSTEM or Administrator have no rights to modify these, this leads to Exceptions / Errors)

## The Solution:
PowerShell-Script `Remove-all-ProcessMitigations.ps1`
* Removes all currently configured ProcessMitigations
* Can handle such ProcessMitigations that are configured by plain Executable-Names like `notepad.exe` as well as full-path Configurations like `C:\Windows\system32\notepad.exe`
* Can handle Configurations which are unmodifyable by Administrators because ACLs are set to TrustedInstaller by Taking Ownership and resetting the ACLs to defaults (Inherited ACLs)

Demonstration of the Output:
```powershell
PS C:\Temp> .\Remove-all-ProcessMitigations.ps1
```
```
Removing MitigationOptions for:       AcroRd32.exe
Removing MitigationAuditOptions for:  AcroRd32.exe
Removing MitigationOptions for:       AcroRd32Info.exe
Removing MitigationAuditOptions for:  AcroRd32Info.exe
Removing MitigationOptions for:       iexplore.exe
Removing MitigationAuditOptions for:  iexplore.exe
Removing FullPathEntry:               notepad.exe - C:\Windows\SysWOW64\notepad.exe
Removing FullPathEntry:               notepad.exe - C:\Windows\notepad.exe
Removing FullPathEntry:               notepad.exe - C:\Windows\System32\notepad.exe
Removing empty Entry:                 notepad.exe
Removing MitigationOptions for:       PresentationHost.exe
Removing MitigationAuditOptions for:  PresentationHost.exe
Removing empty Entry:                 PresentationHost.exe
...
```


PowerShell-Script `Windows10-v1709_ExploitGuard-Config.ps1`
* uses `Remove-all-ProcessMitigations.ps1` to remove the Configuration
* Sets the System-Configuration of Exploit-Guard to default
* Imports the Exploit-Guard Default-Settings of Windows 10 v1703 which are provided by `Windows10-v1709_ExploitGuard-DefaultSettings.xml`
* Imports the recommended Baseline-Settings for Windows 10 v1703 which are provided by `Windows10-v1709_ExploitGuard-Security-Baseline.xml`

## Source of the XML-Files
* `Windows10-v1709_ExploitGuard-DefaultSettings.xml` is taken from a fresh Windows 10 v1703 Machine
* `Windows10-v1709_ExploitGuard-Security-Baseline.xml` is taken from the [official Microsoft Baseline](https://blogs.technet.microsoft.com/secguide/2017/10/18/security-baseline-for-windows-10-fall-creators-update-v1709-final/) 

## Links
* [Documentation of Exploit-Guard](https://docs.microsoft.com/en-us/windows/threat-protection/windows-defender-exploit-guard/windows-defender-exploit-guard)
* [EMET - Enhanced Mitigation Experience Toolkit](https://technet.microsoft.com/en-us/security/jj653751)
